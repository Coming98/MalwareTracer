import json
import graphviz

def load_data(file_path):
    with open(file_path, 'r') as f:
        json_data = json.load(f)

    return json_data["nodes"], json_data["edges"]

def graphviz_show(nodes, edges, output_name, output_dir):

    f = graphviz.Digraph('finite_state_machine', filename=f"{output_name}.gv", encoding="utf-8")
    f.attr(rankdir='DR')

    f.attr('node', shape='Box')
    for node in nodes:
        f.node(node)

    f.attr('node', shape='circle')
    for i, edge in enumerate(edges, 1):
        source, api_cat, target = edge
        f.edge(source, target, label=f"{i} {api_cat}")

    f.view(directory=output_dir)

def main(idata_path, input_name, output_dir):

    nodes, edges = load_data(idata_path)

    graphviz_show(nodes, edges, input_name, output_dir)