from process import generate_graph_data, generate_graph
from config import Config
import os

CONFIG = Config()

def process(input_dir, output_dir):
    idata_paths = []
    for input_path in os.listdir(input_dir):
        input_filepath = os.path.join(input_dir, input_path)
        input_name = ".".join(input_path.split('.')[:-1])
        # input_type = input_path.split(".")[-1]

        output_path = generate_graph_data.main(input_filepath, input_name, output_dir)
        idata_paths.append((output_path, input_name))

    # 绘图
    for (idata_path, output_names) in idata_paths:
        generate_graph.main(idata_path, output_names, output_dir)
        generate_graph.main(idata_path, output_names, output_dir, type="detail")

def main():
    # 生成绘图数据
    test_name = "testDemo" # LJDemo / PatchedDemo
    input_dir = f'./inputs/demo_gpr_tracer/{test_name}'
    output_dir = os.path.join(CONFIG.output_dir, test_name)
    if(not os.path.exists(output_dir)):
        os.mkdir(output_dir)

    process(input_dir, output_dir)
    

if __name__ == '__main__':
    main()