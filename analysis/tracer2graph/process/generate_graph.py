import json
import graphviz

def load_data(file_path):
    with open(file_path, 'r') as f:
        json_data = json.load(f)

    return json_data["block_attr_dict"], json_data["edges"]

def graphviz_show(block_attr_dict, edges, output_name, output_dir, type=None):
    output_filename = output_name + ("" if type is None else f".{type}") + ".gv"
    f = graphviz.Digraph('finite_state_machine',
                         filename=output_filename, encoding="utf-8",
                         format="pdf")
    f.attr(rankdir='DR')

    f.attr('node', shape='box')
    for key, value in block_attr_dict.items():
        if(type == "detail"):
            f.node(key, label=repr(value["text"]).strip("'"))
        else:
            f.node(key)
    for edge in edges:
        f.edge(edge[0], edge[1])

    f.view(directory=output_dir)

def main(file_path, output_name, output_dir, type=None):

    block_attr_dict, edges = load_data(file_path)

    graphviz_show(block_attr_dict, edges, output_name, output_dir, type)